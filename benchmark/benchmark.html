<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
  <head> 
    <title>Gordon: An open source flashâ„¢ runtime written in pure JavaScript</title> 
    <script type="text/javascript" src="../dist/gordon.js"></script>
  </head> 
  <body>
  	<script>
  	function $(id) {
  		return document.getElementById(id);
  	}

    function getResolution() {
        var reses = document.querySelectorAll('input[name=resolution]');
        for(var i in reses) {
            var res = reses[i];
            if(res.checked) {
                var size = document.querySelector('label[for='+res.id+']').innerHTML.split('x');
                return {width: parseInt(size[0]), height: parseInt(size[1])};
            }
        }

        return {width: 512, height: 512};
    }

  	function bench(swf, time, render, cb) {
        var res = getResolution();
        console.profile(swf);
  		var m = new Gordon.Movie(swf, {id: 'stage', width: res.width, height: res.height, renderer: render});
  		var timer = setTimeout(function() {
  	  		m.stop();
            console.profileEnd(swf);
  	  		if(cb) {
  	  			setTimeout(function() {cb(m.times);}, 500);
  	  		}
  		}, time);
  		return m;
  	}

  	onload = function() {
  	  	$('start').addEventListener('click', function() {
  	  	  	bench($('swf').value, parseInt($('time').value), Gordon[$('renderer').value], function(times) {
	  	  	  	var fps = times.length * 1000 / times.reduce(function(a,b){return a+b;});
	  	  	  	$('result').innerHTML = 'FPS: '+fps.toPrecision(5);
  	  	  	});
  	  	}, false);
  	};
  	</script>
  	<label>SWF</label>
  	<select id="swf">
  		<option value="blue.swf">blue.swf</option>
  		<option value="test.swf">test.swf</option>
  		<option value="car_smash.swf">car_smash.swf</option>
  		<option value="gradient-tests.swf">gradient-tests.swf</option>
  		<option value="test3.swf">test3.swf</option>
  		<option value="tiger.swf">tiger.swf</option>
  		<option value="trip.swf">trip.swf</option>
  	</select>
  	<label>Time</label>
  	<input type="text" id="time" value="20000"/>
  	<label>Renderer</label>
  	<select id="renderer">
  		<option value="CanvasRenderer">CanvasRenderer</option>
  		<option value="SvgRenderer">SvgRenderer</option>
  	</select>
    <input type="radio" id="res0" name="resolution"/><label for="res0">64x64</label>
    <input type="radio" id="res1" name="resolution"/><label for="res1">128x128</label>
    <input type="radio" id="res2" name="resolution"/><label for="res2">256x256</label>
    <input type="radio" id="res3" name="resolution" checked="checked"/><label for="res3">512x512</label>
    <input type="radio" id="res4" name="resolution"/><label for="res4">1024x1024</label>
  	<input type="button" id="start" value="Start"/>
  	<span id="result"></span>
    <div id="stage"></div>
  </body> 
</html>
